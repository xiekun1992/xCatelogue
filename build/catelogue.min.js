/**
 * Version: 1.0.0
 * Home page: https://github.com/xiekun1992/xCatelogue
 */
!function(t){"function"==typeof define&&define.amd?define("xCatelogue",t):"object"==typeof module&&module.exports&&"object"==typeof exports?module.exports=t():"object"==typeof exports?exports.xCatelogue=t():this.xCatelogue=t()}(function(){"use strict";var t=function(t){if(this.element=null,this.catelogue=[],this.elementOffsetTop=[],this.titles={},this.titleTags=["H1","H2","H3","H4","H5","H6"],this.useCustomTitles=!1,this.selector=t.contentContainer,this.showBackToTop=t.showBackToTop,"[object Array]"===Object.prototype.toString.call(t.customTitles)&&t.customTitles.length>0&&t.customTitleAttr&&(this.titleTags=t.customTitles,this.customTitleAttr=t.customTitleAttr,this.useCustomTitles=!0),void 0===this.showBackToTop&&(this.showBackToTop=!0),!this.selector)throw new Error("contentContainer can not be found");if(this.element=document.querySelector(this.selector),!this.element)throw new Error("contentContainer must be a valid Selector");if(this.extractTitle(),t.catelogueContainer){if(this.catelogueContainer=document.querySelector(t.catelogueContainer),!this.element)throw new Error("catelogueContainer must be a valid Selector");this.catelogueContainer.innerHTML+=this.generateCatelogue()}};t.prototype.extractTitle=function(){for(var t=0;t<this.titleTags.length;t++){var e=this.titleTags[t].toLowerCase(),i=e;this.useCustomTitles&&(i="*["+this.customTitleAttr+'="'+e+'"]'),this.titles[e]=Array.prototype.slice.call(document.querySelectorAll(this.selector+" "+i))}l(this.titles)},t.prototype.generateCatelogue=function(t){return(t||0==this.catelogue.length)&&(this.catelogue.length=0,this.updateCatelogue()),'<div class="x-catelogue">'+s(this.catelogue,this.showBackToTop)+"</div>"},t.prototype.updateCatelogue=function(){e={self:this.element,children:this.catelogue,parent:null};for(var t=Array.prototype.slice.call(this.element.children),i=0;i<t.length;i++){var o=t[i];-1!=this.titleTags.indexOf(this.getTitleFlag(o))&&this.elementOffsetTop.push({offsetTop:n(o),id:o.getAttribute("id")})}this.elementOffsetTop.push({offsetTop:1/0}),this.seekForHierarchy(this.element.children[0],e)},t.prototype.bootstrap=function(){var t=Array.prototype.slice.call(document.querySelectorAll(".x-catelogue a"));r=!1;for(var e=0;e<t.length;e++){var s=t[e];0==s.getAttribute("href").indexOf("#")&&s.addEventListener("click",function(t){r=!0,i(t.target.getAttribute("href"))},!1)}this.catelogue.length&&(o.call(this),window.addEventListener("scroll",o.bind(this)))},t.prototype.seekForHierarchy=function(t,i){if(t instanceof HTMLElement){var o={self:t,children:[],parent:i},r=this.getTitleFlag(t),s=this.titleTags.indexOf(r),l=t.nextElementSibling;if(-1!=s&&i.children.push(o),l){var n=this.titleTags.indexOf(this.getTitleFlag(l));if(-1==n)this.seekForHierarchy(l,-1!=s?o:i);else if(-1!=s&&n>s)this.seekForHierarchy(l,o);else if(n==s)this.seekForHierarchy(l,i);else{for(var a=i;a&&this.titleTags.indexOf(this.getTitleFlag(a.self))>=this.titleTags.indexOf(this.getTitleFlag(l));)a=a.parent;-1!=s?this.seekForHierarchy(l,a&&a.parent||e):this.seekForHierarchy(l,a&&a||e)}}}},t.prototype.getTitleFlag=function(t){return this.useCustomTitles?t.getAttribute(this.customTitleAttr):t.tagName};var e,i=function(t){if(t.length>1){for(var e=Array.prototype.slice.call(document.querySelectorAll(".x-catelogue a")),i=0;i<e.length;i++)e[i].classList.remove("active");var o=document.querySelectorAll("a[href='"+t+"']");o&&o.forEach(function(t){t.classList.add("active")})}},o=function(){if(r)return r=!1;var t;if(window.scrollY+window.innerHeight>=document.body.clientHeight)t=this.elementOffsetTop[this.elementOffsetTop.length-2].id;else for(var e=this.elementOffsetTop[0],o=0;o<this.elementOffsetTop.length;o++){var s=this.elementOffsetTop[o];if(s.offsetTop==window.scrollY||s.offsetTop==window.scrollY+1){t=s.id;break}if(s.offsetTop>window.scrollY){t=e.id;break}e=s}i("#"+t)},r=!1,s=function(t,e){var i="";if(t.length>0){for(var o in t)if(t.hasOwnProperty(o)){var r=t[o],l=s(r.children);i+='<li><a href="#'+r.self.getAttribute("id")+'">'+r.self.innerText+"</a>"+l+"</li>"}i=e?i+'<li><a href="javascript:window.scrollTo(0, 0)">回到顶部</a></li>':i,i="<ul>"+i+"</ul>"}return i},l=function(t){for(var e in t)t.hasOwnProperty(e)&&t[e].forEach(function(t,i){t.setAttribute("id","xCategory"+e+"-"+i)})},n=function(t){var e=t.offsetTop,i=t.offsetParent;return i&&e+n(i)||e};return t});